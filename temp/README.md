<!DOCTYPE html>

<html lang="en">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1" name="viewport"/>
<title>~tomh/dragonflybsd-on-a-laptop (master): README.md - sourcehut git</title>
<link href="/static/logo.svg" rel="icon" type="image/svg+xml"/>
<link href="/static/logo.png" rel="icon" sizes="any" type="image/png"/>
<link href="/static/main.min.df853ed0.css" rel="stylesheet"/>
<style>
pre {
  tab-size: 8
}
</style>
<meta content="git" name="vcs"/>
<meta content="https://git.sr.ht/~tomh/dragonflybsd-on-a-laptop" name="vcs:clone"/>
<meta content="git@git.sr.ht:~tomh/dragonflybsd-on-a-laptop" name="vcs:clone"/>
<meta content="https://git.sr.ht/~tomh/dragonflybsd-on-a-laptop" name="forge:summary"/>
<meta content="https://git.sr.ht/~tomh/dragonflybsd-on-a-laptop/tree/{ref}/{path}" name="forge:dir"/>
<meta content="https://git.sr.ht/~tomh/dragonflybsd-on-a-laptop/tree/{ref}/{path}" name="forge:file"/>
<meta content="https://git.sr.ht/~tomh/dragonflybsd-on-a-laptop/blob/{ref}/{path}" name="forge:rawfile"/>
<meta content="https://git.sr.ht/~tomh/dragonflybsd-on-a-laptop/tree/{ref}/{path}#L{line}" name="forge:line"/>
<meta content="git.sr.ht/~tomh/dragonflybsd-on-a-laptop git https://git.sr.ht/~tomh/dragonflybsd-on-a-laptop" name="go-import"/>
</head>
<body>
<nav class="navbar navbar-light navbar-expand-sm">
<span class="navbar-brand">
<span aria-hidden="true" class="icon icon-circle"><svg height="22" viewbox="0 0 512 512" width="22" xmlns="http://www.w3.org/2000/svg"><path d="M256 8C119 8 8 119 8 256s111 248 248 248 248-111 248-248S393 8 256 8zm0 448c-110.5 0-200-89.5-200-200S145.5 56 256 56s200 89.5 200 200-89.5 200-200 200z"></path></svg>
</span>
<a href="https://sr.ht">
    sourcehut
  </a>
</span>
<ul class="navbar-nav">
</ul>
<div class="login">
<span class="navbar-text">
<a href="https://meta.sr.ht/oauth/authorize?client_id=25ff6e5ce60d7345&amp;scopes=profile,keys,b99a95de3e69c958/jobs:write&amp;state=%2F~tomh%2Fdragonflybsd-on-a-laptop%2Ftree%2Fmaster%2Fitem%2FREADME.md%3F" rel="nofollow">Log in</a>
    —
    <a href="https://meta.sr.ht">Register</a>
</span>
</div>
</nav>
<div class="header-tabbed">
<div class="container-fluid">
<h2>
<a href="/~tomh/">~tomh</a>/<wbr/>dragonflybsd-on-a-laptop
    </h2>
<ul class="nav nav-tabs">
<li class="nav-item">
<a class="nav-link" href="/~tomh/dragonflybsd-on-a-laptop">summary</a>
</li>
<li class="nav-item">
<a class="nav-link active" href="/~tomh/dragonflybsd-on-a-laptop/tree">tree</a>
</li>
<li class="nav-item">
<a class="nav-link" href="/~tomh/dragonflybsd-on-a-laptop/log">log</a>
</li>
<li class="nav-item">
<a class="nav-link" href="/~tomh/dragonflybsd-on-a-laptop/refs">refs</a>
</li>
</ul>
</div>
</div>
<div class="header-extension" style="margin-bottom: 0;">
<div class="blob container-fluid">
<span>
<a href="/~tomh/dragonflybsd-on-a-laptop/tree/master">dragonflybsd-on-a-laptop</a>/README.md



  
  
  <span class="text-muted" style="margin-left: 1rem">
<span title="100644">
      -rw-r--r--
    </span>
</span>
<span class="text-muted" style="margin-left: 1rem">
<span title="6973 bytes">
        6.8 KiB
      </span>
</span>
<div class="blob-nav" style="margin-left: 1rem">
<ul class="nav nav-tabs">
<li class="nav-item">
<a class="nav-link active" href="/~tomh/dragonflybsd-on-a-laptop/tree/master/item/README.md">View</a>
</li>
<li class="nav-item">
<a class="nav-link" href="/~tomh/dragonflybsd-on-a-laptop/log/master/item/README.md">Log</a>
</li>
<li class="nav-item">
<a class="nav-link" href="/~tomh/dragonflybsd-on-a-laptop/blame/master/README.md">Blame</a>
</li>
<li class="nav-item">
<a class="nav-link" href="/~tomh/dragonflybsd-on-a-laptop/blob/master/README.md" rel="noopener noreferrer nofollow">View raw</a>
</li>
<li class="nav-item">
<a class="nav-link" href="/~tomh/dragonflybsd-on-a-laptop/tree/92ae9ff6db2d3786f8070524b6f44599ff503169/item/README.md">Permalink</a>
</li>
</ul>
</div>
</span>
<div class="commit">
<a href="/~tomh/dragonflybsd-on-a-laptop/commit/master">92ae9ff6</a> —
      
      
      <a href="/~tomh/">Tom Harned</a>
      
      add log files associated with elantech troubleshooting
      <span class="text-muted">
<span title="2024-01-26 20:01:34 UTC">6 days ago</span>
</span>
</div>
<div class="clearfix"></div>
</div>
</div>
<div class="container-fluid markdown-nav">
<ul class="nav nav-tabs">
<li class="nav-item">
<a class="nav-link active" href="?view-rendered">View Rendered</a>
</li>
<li class="nav-item">
<a class="nav-link" href="?view-source">View Source</a>
</li>
</ul>
</div>
<div class="container">
<div class="row" style="margin-right: 0;">
<div class="col-md-10 offset-md-1" style="margin-top: 1rem">
<style>.highlight { background: inherit; }</style><div class="markdown"><h2 id="dragonfly-bsd-on-a-thinkpad-t480s"><a href="#dragonfly-bsd-on-a-thinkpad-t480s" rel="nofollow noopener">#</a>DragonFly BSD on a Thinkpad T480s</h2>
<p>I took some time off work at the end of December and decided to play around with DragonFlyBSD, a really interesting OS. I really like the simplicity of the family of BSD operating systems. For a while I ran OpenBSD as a daily driver on a number of different laptops. OpenBSD is a great OS, but it is not very performant, nor is performance something the OpenBSD team prioritizes, which led me to DragonFlyBSD, the snappiest, most performant BSD of the bunch.</p>
<h3 id="initial-installation"><a href="#initial-installation" rel="nofollow noopener">#</a>Initial Installation</h3>
<p>Download the USB image from the <a href="https://www.dragonflybsd.org/download/" rel="nofollow noopener">DragonFlyBSD Website</a>. I was able to use UEFI and follow the defaults on the install process. **One thing I did do was add my user to the "wheel" and "video" groups, which you need to do for sudo and X, respectively. DragonFlyBSD <strong>does not</strong> come with Xorg installed, so on your initial boot you'll just get a bash shell prompt with good 'ole vi as your editor.</p>
<h3 id="install-packages"><a href="#install-packages" rel="nofollow noopener">#</a>Install Packages</h3>
<ul>
<li>Like most of the BSDs, DragonFlyBSD comes with a minimal, but thoughtful set oof initial programs, so you'll want to start by copying the sample repository config to start installing basic packages.</li>
</ul>
<div class="highlight"><pre><span></span>cp /usr/local/etc/pkg/repos/df-latest.conf.sample /usr/local/etc/pkg/repos/df-latest.conf
</pre></div>
<div class="highlight"><pre><span></span><span class="c1"># Install a few useful programs to make setup easier</span>
pkg upgrade
pkg update
pkg install bash vim sudo curl hexchat firefox keepassxc
</pre></div>
<p>I had to remove <code>/usr/local/bin/openssl</code> at this step due to conflicts with libressl</p>
<h3 id="wifi"><a href="#wifi" rel="nofollow noopener">#</a>Wifi</h3>
<p>My router is in a cold, unfinished basement, so one of the first things I did was set up wifi, which was a breeze. Most of the section below is shamelessly lifted from the <a href="https://www.dragonflybsd.org/docs/docs/newhandbook/WirelessNetwork/" rel="nofollow noopener">DragonFlyBSD Website</a>.</p>
<p>The wireless device on the T480s is identified as iwm0. Add the iwm drivers to /boot/loader.conf.</p>
<div class="highlight"><pre><span></span><span class="c1"># boot/loader.conf</span>

<span class="nv">if_iwm_load</span><span class="o">=</span><span class="s2">"YES"</span>
<span class="nv">iwm3160fw_load</span><span class="o">=</span><span class="s2">"YES"</span>
<span class="nv">iwm3168fw_load</span><span class="o">=</span><span class="s2">"YES"</span>
<span class="nv">iwm7260fw_load</span><span class="o">=</span><span class="s2">"YES"</span>
<span class="nv">iwm7265fw_load</span><span class="o">=</span><span class="s2">"YES"</span>
<span class="nv">iwm7265Dfw_load</span><span class="o">=</span><span class="s2">"YES"</span>
<span class="nv">iwm8000Cfw_load</span><span class="o">=</span><span class="s2">"YES"</span>
<span class="nv">iwm8265fw_load</span><span class="o">=</span><span class="s2">"YES"</span>
<span class="nv">iwm9000fw_load</span><span class="o">=</span><span class="s2">"YES"</span>
<span class="nv">iwm9260fw_load</span><span class="o">=</span><span class="s2">"YES"</span>
</pre></div>
<p>The version of WPA Supplicant that comes with DragonFlyBSD is old, so it's a good idea to install the newer version from packages.</p>
<p><code>pkg install wpa_supplicant</code></p>
<p>Next, setup WPA Supplicant by configuring in <code>/etc/rc.conf</code>.</p>
<p><code># echo wpa_supplicant_program="/usr/local/sbin/wpa_supplicant" &gt;&gt; /etc/rc.conf</code></p>
<p>Open `/etc/wpa_supplicant.conf. Replace myssid and mypsk with your own SSID and PSK. If the file doesn't exist, create it.</p>
<div class="highlight"><pre><span></span><span class="nv">network</span><span class="o">={</span>
    <span class="nv">ssid</span><span class="o">=</span><span class="s2">"myssid"</span>
    <span class="nv">psk</span><span class="o">=</span><span class="s2">"mypsk"</span>
<span class="o">}</span>
</pre></div>
<p>Add entries to /etc/rc.conf to configure the network on startup:</p>
<div class="highlight"><pre><span></span><span class="nv">wlans_ral0</span><span class="o">=</span><span class="s2">"wlan0"</span>
<span class="nv">ifconfig_wlan0</span><span class="o">=</span><span class="s2">"WPA DHCP"</span>
</pre></div>
<p>Reboot to get the wifi drivers and test your connection</p>
<h3 id="enable-sudo"><a href="#enable-sudo" rel="nofollow noopener">#</a>Enable Sudo</h3>
<div class="highlight"><pre><span></span><span class="c1"># cat /usr/local/etc/sudoers</span>

<span class="c1"># uncomment line with:</span>
%wheel <span class="nv">ALL</span><span class="o">=(</span>ALL:ALL<span class="o">)</span> ALL
</pre></div>
<p>Make sure your user is part of the wheel group and video;you can do this during install.</p>
<h3 id="install-x"><a href="#install-x" rel="nofollow noopener">#</a>Install X</h3>
<p>I ran into a number of issues here, first getting a segfault when I tried to start X and then X loading but with no keyboard support. Big thanks to @aly and @dataupe on the #dragonflybsd irc who gave me some crucial pointers to push through.</p>
<p>Install xorg, a desktop enviroment, and a display manager</p>
<pre><code>pkg install xorg xfce xdm
</code></pre>
<p>To get X to start, you need to install and configure the appropriate display driver.</p>
<div class="highlight"><pre><span></span>pkg install xf86-video-scfb
</pre></div>
<p>Create the file <code>/usr/local/etc/X11/xorg/xorg.conf.d/driver-scfb.conf</code> and add the following lines to it:</p>
<div class="highlight"><pre><span></span>Section <span class="s2">"Device"</span>
Identifier <span class="s2">"Card0"</span>
Driver <span class="s2">"scfb"</span>
EndSection
</pre></div>
<p>This got X working, but I couldn't use the keyboard. To rectify that, install and configure evdev drivers:</p>
<p><code># pkg install xf86-input-evdev</code></p>
<p><code># echo kern.evdev.rcpt_mask=3 &gt;&gt; sysctl.conf</code></p>
<p>Enable xdm:</p>
<p><code># echo xdm="YES" &gt;&gt; /etc/rc.conf</code></p>
<p><em>Update:</em> xdm crashes on logout requiring a hard reset. I've found that the slim display manager works better. To install and enable slim:</p>
<p><code>sudo pkg install slim</code>
<code># echo slim_enable="YES" &gt;&gt; /etc/rc.conf</code></p>
<p>Add the following to /etc/rc.conf:</p>
<div class="highlight"><pre><span></span><span class="nv">dbus_enable</span><span class="o">=</span><span class="s2">"YES"</span>
 <span class="nv">hald_enable</span><span class="o">=</span><span class="s2">"YES"</span>
</pre></div>
<p>Finally, configure $HOME/.xsession</p>
<div class="highlight"><pre><span></span>xset b off <span class="c1"># disable the system beep</span>
xmodmap <span class="nv">$HOME</span>/.Xmodmap
<span class="nb">exec</span> startxfce4
</pre></div>
<h3 id="change-default-shell-to-bash"><a href="#change-default-shell-to-bash" rel="nofollow noopener">#</a>Change Default Shell to Bash</h3>
<p><code>chsh</code></p>
<ul>
<li>create .bashrc and bash_profile for root and user</li>
</ul>
<p>Reboot</p>
<h3 id="setting-up-the-window-manager"><a href="#setting-up-the-window-manager" rel="nofollow noopener">#</a>Setting up the window manager</h3>
<p>The default font in twm and ctwm is <strong>very</strong> small, so let's make it bigger by adding the following lines to <code>$HOME/.Xdefaults</code>:</p>
<div class="highlight"><pre><span></span>xterm*faceName: Monospace
xterm*faceSize: <span class="m">13</span>
</pre></div>
<p>If you're a vim user, this is always a critical tweak:</p>
<div class="highlight"><pre><span></span><span class="c1"># cat $HOME/.Xmodmap</span>

!Swap Caps_Lock with Escape
remove <span class="nv">Lock</span> <span class="o">=</span> Caps_Lock
keysym <span class="nv">Caps_Lock</span> <span class="o">=</span> Escape
keysym <span class="nv">Escape</span> <span class="o">=</span> Caps_Lock
add <span class="nv">Lock</span> <span class="o">=</span> Caps_Lock
</pre></div>
<p>Then add it to xession:</p>
<p><code>xmodmap $HOME/.Xmodmap &gt;&gt; $HOME/.xsession</code></p>
<p>It's also good to shut off that annoying beep;</p>
<p><code>echo xset b off &gt;&gt; $HOME/.xsession</code></p>
<h3 id="get-sound-working"><a href="#get-sound-working" rel="nofollow noopener">#</a>Get sound working</h3>
<p>Taken from: <a href="https://panoramacircle.com/2018/10/07/setup-dragonflybsd-with-a-desktop-on-real-hardware-thinkpad-t410/" rel="nofollow noopener">https://panoramacircle.com/2018/10/07/setup-dragonflybsd-with-a-desktop-on-real-hardware-thinkpad-t410/</a></p>
<p>Add the following lines to: <code>/boot/loader.conf</code></p>
<div class="highlight"><pre><span></span><span class="c1"># cat /boot/loader.conf</span>
<span class="nv">snd_hda_load</span><span class="o">=</span><span class="s2">"YES"</span>
<span class="nv">snd_uaudio_load</span><span class="o">=</span><span class="s2">"YES"</span>
</pre></div>
<h3 id="tuning-for-energy-use"><a href="#tuning-for-energy-use" rel="nofollow noopener">#</a>Tuning for energy use</h3>
<ul>
<li>Add to /etc/sysctl.conf</li>
</ul>
<pre><code>## CPU States
# hw.acpi.cpu.cx_lowest=C3 # this setting made by computer too slow
hw.acpi.cpu.cx_lowest=C2 # this worked better, but battery life obv not as good
machdep.mwait.CX.idle=AUTODEEP
</code></pre>
<ul>
<li>Add to /etc/rc.conf</li>
</ul>
<p><code>powerd_enable="YES"</code></p>
<h3 id="outstanding-issues"><a href="#outstanding-issues" rel="nofollow noopener">#</a>Outstanding Issues</h3>
<h4 id="touchpad"><a href="#touchpad" rel="nofollow noopener">#</a>Touchpad</h4>
<p>The biggest headache by far for me which I have not been able to resolve get is getting the touchpad working to my liking. I use the <a href="http://acme.cat-v.org/" rel="nofollow noopener">Acme Editor</a> so the touchpad needs to either work very well or I'm turning it off. The touchpad on the ThinkPad T480s is an Elantech. I was able to enable enable elantech support but it turned into a game of device driver whack-a-mole. Every time I got one feature working, something else stopped working. I eventually gave up and plugged in an Evoluent three-button mouse, which works quite nicely in the xfce DE. I'm going to take another shot at getting the trackpad working, focusing on the following:</p>
<ul>
<li>decrease sensativity</li>
<li>disable touchpad while typing</li>
<li>enable two-finger scrolling</li>
<li>recognize all three physical buttons</li>
</ul>
<h4 id="mouse---quotgood-enoughquot-solution"><a href="#mouse---quotgood-enoughquot-solution" rel="nofollow noopener">#</a>Mouse - "Good Enough" Solution</h4>
<p>Add the following lines to /ect/rc.conf</p>
<div class="highlight"><pre><span></span><span class="c1"># cat  /ect/rc.conf</span>

<span class="nv">moused_enable</span><span class="o">=</span><span class="s2">"YES"</span>
<span class="nv">moused_type</span><span class="o">=</span><span class="s2">"auto"</span>
<span class="nv">moused_port</span><span class="o">=</span><span class="s2">"/dev/psm0"</span>
<span class="nv">moused_flags</span><span class="o">=</span><span class="s2">"-V"</span>
</pre></div>
<h3 id="other-issues"><a href="#other-issues" rel="nofollow noopener">#</a>Other Issues</h3>
<ul>
<li>Buttons on top don't work except mute/unmute</li>
<li>Laptop is a little slow after battery saving tweaks - I'm going to play with this more</li>
<li>Suspend/Resume doesn't work, but that's an issue even in a lot of linux distros</li>
</ul>
<h3 id="other-todox27s"><a href="#other-todox27s" rel="nofollow noopener">#</a>Other Todo's</h3>
<ul>
<li>Get volume buttons working</li>
<li>Adjust Backlight:    <a href="https://www.dragonflybsd.org/docs/Powersave" rel="nofollow noopener">https://www.dragonflybsd.org/docs/Powersave</a></li>
</ul>
</div>
</div>
</div>
<script src="/static/linelight.js"></script>
</div></body>
</html>